<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>منصة الخدمات الطلابية</title>
    
    <!-- مكتبة Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- مكتبة jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    
    <!-- مكتبة html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <!-- أيقونات Lucide -->
    <script src="https://cdn.jsdelivr.net/npm/lucide@latest/dist/umd/lucide.js"></script>

    <!-- خطوط -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@200;300;400;500;700;800&family=Reem+Kufi:wght@400;500;600;700&family=Kalam:wght@300;400;700&family=Almarai:wght@300;400;700;800&family=Amiri:ital,wght@0,400;0,700;1,400&family=Cairo:wght@300;400;700;900&family=Changa:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@300;400;700&family=Lalezar&family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/sf-pro-display" rel="stylesheet">

    <style>
        /* الأساسيات */
        body { font-family: 'Tajawal', sans-serif; background-color: #000; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .font-brand { font-family: 'Reem Kufi', sans-serif; }
        .font-hand { font-family: 'Kalam', cursive; }

        /* خطوط المحرر */
        .font-amiri { font-family: 'Amiri', serif; }
        .font-cairo { font-family: 'Cairo', sans-serif; }
        .font-tajawal { font-family: 'Tajawal', sans-serif; }
        .font-almarai { font-family: 'Almarai', sans-serif; }
        .font-scheherazade { font-family: 'Scheherazade New', serif; }
        .font-reem { font-family: 'Reem Kufi', sans-serif; }
        .font-ibm { font-family: 'IBM Plex Sans Arabic', sans-serif; }
        .font-changa { font-family: 'Changa', sans-serif; }
        .font-lalezar { font-family: 'Lalezar', cursive; }

        /* الطباعة */
        @media print {
            body * { visibility: hidden; }
            #pdf-print-container, #pdf-print-container * { visibility: visible; }
            #pdf-print-container {
                position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 2cm;
                background: white; color: black; font-size: 14pt; line-height: 1.8;
                direction: rtl; font-family: 'Tajawal', sans-serif; white-space: pre-wrap;
            }
            .aurora-bg, .orb, #banner, .qr-fab, .chat-fab, nav, #toast { display: none !important; }
        }

        /* الخلفية */
        .aurora-bg { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: radial-gradient(circle at 50% 50%, #1a1a1a 0%, #000000 100%); z-index: -2; }
        .orb { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.4; animation: float 10s infinite ease-in-out alternate; }
        .orb-1 { width: 400px; height: 400px; background: #2b3a42; top: -10%; left: -10%; }
        .orb-2 { width: 500px; height: 500px; background: #1c2541; bottom: -10%; right: -10%; animation-delay: 2s; }
        .orb-3 { width: 300px; height: 300px; background: #3a506b; top: 300px; left: 40%; animation-delay: 4s; opacity: 0.2; }
        @keyframes float { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(30px, -30px) scale(1.1); } }

        /* واجهة المستخدم العامة */
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255, 255, 255, 0.08); border-radius: 24px; }
        .glass-card { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 20px; transition: 0.3s; cursor: pointer; position: relative; overflow: hidden; }
        .glass-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-5px); border-color: rgba(255, 255, 255, 0.25); }
        .glass-input { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); color: white; transition: 0.3s; }
        .glass-input:focus { border-color: rgba(255, 255, 255, 0.3); outline: none; }
        
        .apple-btn { background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border: 1px solid rgba(255,255,255,0.1); position: relative; overflow: hidden; transition: 0.2s; cursor: pointer; }
        .apple-btn:active { transform: scale(0.98); }

        .view-section { display: none; opacity: 0; transition: opacity 0.4s; width: 100%; }
        .view-section.active { display: flex; opacity: 1; }

        #banner { position: fixed; top: 20px; left: 50%; transform: translateX(-50%) translateY(-200%); width: 90%; max-width: 400px; background: rgba(35, 35, 35, 0.9); backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.15); border-radius: 22px; padding: 14px; z-index: 100; transition: 0.6s; display: flex; align-items: center; justify-content: space-between; cursor: grab; }
        #banner.show { transform: translateX(-50%) translateY(0); }

        /* --- تنسيقات محرر المستندات الجديد --- */
        .page-wrapper { position: relative; margin-bottom: 2rem; transition: all 0.3s; padding-top: 20px; }
        .a4-page {
            width: 210mm; min-height: 297mm; padding: 2.5cm; margin: auto;
            background-color: white; color: black;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            outline: none; overflow-wrap: break-word; word-wrap: break-word; position: relative;
            transition: background-color 0.3s;
        }
        .delete-page-btn {
            position: absolute; top: -15px; left: 10px; background-color: #ef4444; color: white;
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; opacity: 1 !important; transition: all 0.2s; z-index: 20;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3); border: 2px solid #1e293b;
        }
        .delete-page-btn:hover { background-color: #dc2626; transform: scale(1.1); }
        .a4-page img {
            max-width: 100%; height: auto; margin: 5px; display: inline-block;
            border: 2px solid transparent; transition: border-color 0.2s; cursor: move;
        }
        .a4-page img.img-selected { border-color: #3b82f6; box-shadow: 0 0 10px rgba(59, 130, 246, 0.5); }
        [contenteditable]:empty:before { content: attr(placeholder); color: #9ca3af; cursor: text; display: block; }
        
        .toolbar-btn { padding: 0.5rem; border-radius: 0.375rem; color: #e2e8f0; transition: all 0.2s; }
        .toolbar-btn:hover { background-color: #334155; color: white; }
        .toolbar-btn.active { background-color: #475569; color: #38bdf8; }
        .img-control-btn { color: #93c5fd; }
        .img-control-btn:hover { background-color: #1e3a8a; color: white; }
        .loading-spinner { border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid #fff; border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); display: flex; justify-content: center; align-items: center;
            z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background-color: white; padding: 2rem; border-radius: 0.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); width: 90%; max-width: 400px;
            transform: scale(0.95); transition: transform 0.3s; color: #1f2937;
        }
        .modal-overlay.active .modal-content { transform: scale(1); }

        /* Calculator */
        .ios-calc-btn { @apply rounded-full text-2xl font-medium transition-all active:scale-95 flex items-center justify-center cursor-pointer select-none; height: 70px; width: 70px; font-family: 'SF Pro Display', sans-serif; }
        .ios-btn-num { background-color: #333; color: white; } .ios-btn-sci { background-color: #212121; color: white; font-size: 0.85rem; }

        /* Timer & ToDo & Quiz */
        .timer-circle circle { transition: stroke-dashoffset 1s linear, stroke 0.3s ease; }
        .todo-item { animation: slideIn 0.3s ease-out forwards; }
        .quiz-radio-wrapper { @apply flex items-center gap-3 p-3 rounded-xl border border-white/10 bg-black/20 hover:bg-white/5 transition-all cursor-pointer relative overflow-hidden; }
        .quiz-radio:checked + .quiz-radio-visual { background-color: #10b981; border-color: #10b981; }
        .correct-answer-visual { @apply bg-green-500/20 border-green-500 !important; }
        .wrong-answer-visual { @apply bg-red-500/20 border-red-500 !important; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="text-gray-200 min-h-screen flex flex-col items-center justify-center p-4">

    <div class="aurora-bg"><div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div></div>

    <!-- Banner -->
    <div id="banner">
        <div class="absolute bottom-2 left-1/2 transform -translate-x-1/2 w-12 h-1 bg-white/20 rounded-full"></div>
        <div class="flex items-center gap-4 flex-1 overflow-hidden pb-2">
            <div class="w-12 h-12 flex-shrink-0 rounded-xl bg-white/10 overflow-hidden"><img src="https://www.dropbox.com/scl/fi/pw360ns6lmih3gjvyynf1/4413204.png?rlkey=jw9xdcefhg4vcmm24lbxnvub2&st=wz6b0zuj&raw=1" class="w-full h-full object-cover"></div>
            <div><div class="notification-header"><span class="font-bold">TELEGRAM</span> <span>•</span> <span>الآن</span></div><h3 class="text-base font-bold text-white">الخدمات الطلابية</h3><p class="text-xs text-white/80">انضم للقناة للمزيد من الخدمات!</p></div>
        </div>
        <a href="https://t.me/najaaf1" target="_blank" class="bg-[#2AABEE] text-white p-2 rounded-full shadow-lg"><i data-lucide="send" class="w-4 h-4"></i></a>
    </div>

    <!-- Nav -->
    <nav class="fixed top-0 left-0 w-full p-4 z-50 flex justify-between items-center bg-transparent backdrop-blur-sm pointer-events-none">
        <div class="flex items-center gap-3 pointer-events-auto">
            <a href="https://instagram.com/c4man" target="_blank" class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10">
                <i data-lucide="instagram" class="w-4 h-4 text-white"></i><span class="font-brand font-bold text-lg text-white">@c4man</span>
            </a>
        </div>
        <button id="back-home-btn" onclick="showView('view-home')" class="hidden pointer-events-auto apple-btn px-3 py-1.5 rounded-full text-xs text-white items-center gap-2 bg-white/10 border border-white/10">الرئيسية</button>
    </nav>

    <!-- HOME VIEW -->
    <div id="view-home" class="view-section active w-full max-w-5xl z-10 mt-20 flex-col items-center pb-20 px-4">
        <header class="text-center mb-8 animate-fade-in">
            <h1 class="text-3xl md:text-5xl font-bold text-white mb-2">الخدمات الطلابية</h1>
            <p class="text-white/50 text-sm md:text-base">مجموعة أدوات ذكية لطلبة الجامعات</p>
        </header>

        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 w-full">
            <!-- 1. PDF (IFRAME) -->
            <div onclick="showView('tool-pdf')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400"><i data-lucide="images" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">صور إلى PDF</h3></div></div>
            <!-- 2. Quiz -->
            <div onclick="showView('tool-quiz')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400"><i data-lucide="brain-circuit" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">منشئ الاختبارات</h3></div></div>
            <!-- 3. Text Editor (IFRAME) -->
            <div onclick="showView('tool-text-pdf')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-amber-500/20 flex items-center justify-center text-amber-400"><i data-lucide="file-text" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">محرر المستندات</h3><p class="text-xs text-white/50">تحويل احترافي لـ PDF</p></div></div>
            <!-- 4. ToDo -->
            <div onclick="showView('tool-todo')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400"><i data-lucide="list-todo" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">قائمة المهام</h3></div></div>
            <!-- 5. Pomodoro -->
            <div onclick="showView('tool-pomodoro')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400"><i data-lucide="timer" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">مؤقت التركيز</h3></div></div>
            <!-- 6. Calculator -->
            <div onclick="showView('tool-calculator')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center text-cyan-400"><i data-lucide="calculator" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">حاسبة علمية</h3></div></div>
            <!-- 7. Notes (IFRAME) -->
            <div onclick="showView('tool-notes')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-yellow-500/20 flex items-center justify-center text-yellow-400"><i data-lucide="sticky-note" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">لوحة الملاحظات</h3><p class="text-xs text-white/50">أوراق لاصقة</p></div></div>
            <!-- 8. QR (IFRAME) -->
            <div onclick="showView('tool-qr')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-white/10 flex items-center justify-center text-white"><i data-lucide="qr-code" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">ماسح الكود</h3></div></div>
            <!-- 9. Support -->
            <div onclick="showView('tool-chat')" class="glass-card p-6 flex items-center gap-4"><div class="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center text-indigo-400"><i data-lucide="message-circle" class="w-6 h-6"></i></div><div><h3 class="font-bold text-white">الدعم الفني</h3></div></div>
        </div>
    </div>

    <!-- TOOLS -->

    <!-- 1. Images to PDF Tool (IFRAME) -->
    <div id="tool-pdf" class="view-section fixed inset-0 z-[150] bg-slate-900 flex-col">
        <div class="bg-slate-800 border-b border-slate-700 shadow-lg z-20 px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="showView('view-home')" class="text-slate-400 hover:text-white transition-colors p-1">
                    <i data-lucide="arrow-right" class="w-6 h-6"></i>
                </button>
                <h1 class="text-lg font-bold text-white">تحويل الصور إلى PDF</h1>
            </div>
            <a href="https://engineeralii.github.io/hello/" target="_blank" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1">
                <i data-lucide="external-link" class="w-4 h-4"></i> فتح في نافذة جديدة
            </a>
        </div>
        <iframe src="https://engineeralii.github.io/hello/" class="w-full flex-1 bg-white border-0" allow="clipboard-read; clipboard-write; camera; microphone"></iframe>
    </div>

    <!-- 2. Advanced Text Editor / PDF Tool (IFRAME) -->
    <div id="tool-text-pdf" class="view-section fixed inset-0 z-[150] bg-slate-900 flex-col">
        <div class="bg-slate-800 border-b border-slate-700 shadow-lg z-20 px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="showView('view-home')" class="text-slate-400 hover:text-white transition-colors p-1"><i data-lucide="arrow-right" class="w-6 h-6"></i></button>
                <h1 class="text-lg font-bold text-white">محرر المستندات</h1>
            </div>
            <a href="https://engineeralii.github.io/HH/" target="_blank" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1"><i data-lucide="external-link" class="w-4 h-4"></i> فتح في نافذة جديدة</a>
        </div>
        <iframe src="https://engineeralii.github.io/HH/" class="w-full flex-1 bg-white border-0" allow="clipboard-read; clipboard-write"></iframe>
    </div>

    <!-- 3. Sticky Notes Tool (IFRAME) -->
    <div id="tool-notes" class="view-section fixed inset-0 z-[150] bg-slate-900 flex-col">
        <div class="bg-slate-800 border-b border-slate-700 shadow-lg z-20 px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="showView('view-home')" class="text-slate-400 hover:text-white transition-colors p-1">
                    <i data-lucide="arrow-right" class="w-6 h-6"></i>
                </button>
                <h1 class="text-lg font-bold text-white">لوحة الملاحظات</h1>
            </div>
            <a href="https://engineeralii.github.io/ALI/" target="_blank" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1">
                <i data-lucide="external-link" class="w-4 h-4"></i> فتح في نافذة جديدة
            </a>
        </div>
        <iframe src="https://engineeralii.github.io/ALI/" class="w-full flex-1 bg-white border-0" allow="clipboard-read; clipboard-write"></iframe>
    </div>
    
    <!-- 4. QR Code Tool (IFRAME) -->
    <div id="tool-qr" class="view-section fixed inset-0 z-[150] bg-slate-900 flex-col">
        <div class="bg-slate-800 border-b border-slate-700 shadow-lg z-20 px-4 py-3 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <button onclick="showView('view-home')" class="text-slate-400 hover:text-white transition-colors p-1">
                    <i data-lucide="arrow-right" class="w-6 h-6"></i>
                </button>
                <h1 class="text-lg font-bold text-white">ماسح الكود</h1>
            </div>
            <a href="https://engineeralii.github.io/qr0/" target="_blank" class="text-xs text-blue-400 hover:text-blue-300 flex items-center gap-1">
                <i data-lucide="external-link" class="w-4 h-4"></i> فتح في نافذة جديدة
            </a>
        </div>
        <iframe src="https://engineeralii.github.io/qr0/" class="w-full flex-1 bg-white border-0" allow="clipboard-read; clipboard-write; camera; microphone"></iframe>
    </div>

    <!-- 5. Quiz Maker -->
    <div id="tool-quiz" class="view-section w-full max-w-2xl z-10 mt-20 flex-col">
        <div class="glass-panel p-8 min-h-[500px] relative overflow-hidden">
            <header class="text-center mb-8"><h2 class="text-2xl font-bold text-white mb-2">منشئ الاختبارات الذكي</h2><p class="text-white/50 text-xs">أنشئ سؤالاً، حدد الإجابة، واختبر نفسك.</p></header>
            <div id="quiz-editor" class="flex flex-col gap-6 animate-fade-in">
                <div><label class="text-xs text-white/60 mb-2 block font-bold">نص السؤال:</label><textarea id="q-text" rows="3" class="glass-input w-full p-4 rounded-xl text-right resize-none border-emerald-500/30 focus:border-emerald-500" placeholder="اكتب السؤال هنا..."></textarea></div>
                <div>
                    <label class="text-xs text-white/60 mb-3 block font-bold">الخيارات (حدد الإجابة الصحيحة):</label>
                    <div class="space-y-3">
                        <div class="flex items-center gap-3 bg-white/5 p-2 rounded-xl border border-white/10"><input type="radio" name="correct-ans" value="0" class="w-5 h-5 accent-emerald-500 cursor-pointer"><input type="text" id="opt-0" class="bg-transparent text-white w-full outline-none placeholder-white/30" placeholder="الخيار الأول"></div>
                        <div class="flex items-center gap-3 bg-white/5 p-2 rounded-xl border border-white/10"><input type="radio" name="correct-ans" value="1" class="w-5 h-5 accent-emerald-500 cursor-pointer"><input type="text" id="opt-1" class="bg-transparent text-white w-full outline-none placeholder-white/30" placeholder="الخيار الثاني"></div>
                        <div class="flex items-center gap-3 bg-white/5 p-2 rounded-xl border border-white/10"><input type="radio" name="correct-ans" value="2" class="w-5 h-5 accent-emerald-500 cursor-pointer"><input type="text" id="opt-2" class="bg-transparent text-white w-full outline-none placeholder-white/30" placeholder="الخيار الثالث"></div>
                        <div class="flex items-center gap-3 bg-white/5 p-2 rounded-xl border border-white/10"><input type="radio" name="correct-ans" value="3" class="w-5 h-5 accent-emerald-500 cursor-pointer"><input type="text" id="opt-3" class="bg-transparent text-white w-full outline-none placeholder-white/30" placeholder="الخيار الرابع"></div>
                    </div>
                </div>
                <button onclick="addQuizQuestion()" class="apple-btn w-full py-4 rounded-xl text-white font-bold bg-emerald-600 hover:bg-emerald-500 shadow-lg shadow-emerald-900/20 flex items-center justify-center gap-2"><i data-lucide="plus-circle" class="w-5 h-5"></i> حفظ وإضافة للسجل</button>
                <div class="border-t border-white/10 pt-4 mt-2 flex flex-col gap-3">
                    <div class="flex justify-between items-center text-xs text-white/50"><span>الأسئلة المضافة: <span id="q-count-editor">0</span></span><button onclick="resetQuiz()" class="text-red-400 hover:text-red-300">حذف الكل</button></div>
                    <div id="quiz-list-preview" class="max-h-32 overflow-y-auto custom-scrollbar space-y-2"></div>
                    <button onclick="startQuizMode()" id="start-quiz-btn" class="apple-btn w-full py-3 rounded-xl text-white/90 font-bold bg-white/10 hover:bg-white/20 flex items-center justify-center gap-2 mt-2"><i data-lucide="play" class="w-5 h-5"></i> بدء الاختبار (<span id="q-count">0</span> أسئلة)</button>
                </div>
            </div>
            <div id="quiz-play-area" class="hidden flex-col h-full animate-fade-in">
                <div class="flex justify-between items-center mb-6"><button onclick="exitQuiz()" class="text-white/50 hover:text-white text-sm flex items-center gap-1"><i data-lucide="arrow-right" class="w-4 h-4"></i> خروج</button><span class="text-emerald-400 font-bold text-sm">وضع الاختبار</span></div>
                <div id="quiz-questions-container" class="space-y-6 overflow-y-auto custom-scrollbar flex-1 pr-2"></div>
            </div>
        </div>
    </div>

    <!-- Support Chat Tool -->
    <div id="tool-chat" class="view-section w-full max-w-md z-10 mt-20 flex-col">
        <div class="glass-panel p-0 flex flex-col h-[600px] overflow-hidden">
            <div class="bg-blue-600 p-4 flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <span class="font-bold text-white flex items-center gap-2"><i data-lucide="headset" class="w-5 h-5"></i> الدعم الفني</span>
                </div>
                <button onclick="showView('view-home')" class="text-white hover:bg-blue-700 p-1 rounded-lg transition-colors text-xs flex items-center gap-1">
                    <i data-lucide="home" class="w-4 h-4"></i> الرئيسية
                </button>
            </div>
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto space-y-3 bg-[#121212] custom-scrollbar"><div class="bg-white/10 p-3 rounded-lg rounded-br-none self-end text-sm text-white/80 max-w-[85%]">مرحباً بك! كيف يمكننا مساعدتك اليوم؟</div></div><div class="p-4 bg-[#1a1a1a] border-t border-white/10 flex gap-2"><input type="text" id="chat-input" placeholder="اكتب رسالتك..." class="glass-input flex-1 py-3 px-4 rounded-xl text-sm text-right" onkeypress="if(event.key==='Enter') sendChatMessage()"><button onclick="sendChatMessage()" class="bg-blue-600 hover:bg-blue-500 text-white p-3 rounded-xl transition-colors"><i data-lucide="send" class="w-5 h-5"></i></button></div></div></div>
    
    <!-- Other Tools (Hidden by default) -->
    <div id="tool-todo" class="view-section w-full max-w-2xl z-10 mt-20 flex-col"><div class="glass-panel p-6"><h2 class="text-white text-center mb-4">المهام</h2><div class="flex gap-2 mb-4"><input id="todo-input" class="glass-input flex-1 p-2 rounded-lg text-right" placeholder="مهمة جديدة"><button onclick="addTodo()" class="apple-btn px-4 text-white rounded-lg">+</button></div><div id="todo-list" class="space-y-2"></div></div></div>
    <div id="tool-pomodoro" class="view-section w-full max-w-md z-10 mt-20 flex-col"><div class="glass-panel p-8 flex flex-col items-center text-center"><h2 class="text-2xl font-bold text-white mb-6">مؤقت التركيز</h2><div class="relative w-48 h-48 mb-8"><svg class="w-full h-full -rotate-90 transform timer-circle"><circle cx="96" cy="96" r="88" stroke="#333" stroke-width="8" fill="none" /><circle id="pomo-circle" cx="96" cy="96" r="88" stroke="#ef4444" stroke-width="8" fill="none" stroke-dasharray="553" stroke-dashoffset="0" stroke-linecap="round" /></svg><div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 flex flex-col items-center"><div class="text-4xl font-bold text-white" id="pomo-timer">25:00</div><div class="text-xs text-white/50 mt-1" id="pomo-status-text">وضع التركيز</div></div></div><div class="flex gap-4 mb-6"><button onclick="setPomoMode(25, 'focus')" class="px-4 py-2 rounded-full bg-red-500/20 hover:bg-red-500/30 text-red-300 text-xs font-bold border border-red-500/30 transition-colors">تركيز (25د)</button><button onclick="setPomoMode(5, 'break')" class="px-4 py-2 rounded-full bg-green-500/20 hover:bg-green-500/30 text-green-300 text-xs font-bold border border-green-500/30 transition-colors">راحة (5د)</button></div><button id="pomo-action-btn" onclick="togglePomo()" class="apple-btn w-full py-4 rounded-xl text-white font-bold bg-white/10 hover:bg-white/20">بدء</button></div></div>
    <div id="tool-calculator" class="view-section w-full max-w-md z-10 mt-20 flex-col items-center"><div class="bg-black rounded-[40px] p-4 w-full max-w-[360px] shadow-2xl border border-white/10 relative overflow-hidden"><div class="w-full h-40 mb-2 text-right flex flex-col justify-end px-4"><div id="calc-mode-indicator" class="text-white/30 text-xs mb-1 tracking-widest uppercase">DEG</div><span id="calc-display" class="text-[3.5rem] font-light text-white leading-none font-sans tracking-tight truncate">0</span></div><div class="flex justify-between mb-4 px-2"><button onclick="toggleCalcMode()" class="text-orange-400 text-xs flex items-center gap-1 hover:text-orange-300 transition-colors"><i data-lucide="flask-conical" class="w-3 h-3"></i> <span id="calc-toggle-text">علمي</span></button><button onclick="deleteCalc()" class="text-white/50 text-xs hover:text-white transition-colors"><i data-lucide="delete" class="w-4 h-4"></i></button></div><div id="scientific-keys" class="grid grid-cols-4 gap-2 mb-3 hidden animate-fade-in transition-all"><button onclick="appendFunc('sin(')" class="ios-btn-sci">sin</button><button onclick="appendFunc('cos(')" class="ios-btn-sci">cos</button><button onclick="appendFunc('tan(')" class="ios-btn-sci">tan</button><button onclick="toggleAngleMode()" class="ios-btn-sci">Deg</button><button onclick="appendFunc('asin(')" class="ios-btn-sci">sin⁻¹</button><button onclick="appendFunc('acos(')" class="ios-btn-sci">cos⁻¹</button><button onclick="appendFunc('atan(')" class="ios-btn-sci">tan⁻¹</button><button onclick="appendFunc('fact(')" class="ios-btn-sci">x!</button><button onclick="appendFunc('sinh(')" class="ios-btn-sci">sinh</button><button onclick="appendFunc('cosh(')" class="ios-btn-sci">cosh</button><button onclick="appendFunc('tanh(')" class="ios-btn-sci">tanh</button><button onclick="appendFunc('abs(')" class="ios-btn-sci">|x|</button><button onclick="appendFunc('log(')" class="ios-btn-sci">log</button><button onclick="appendFunc('ln(')" class="ios-btn-sci">ln</button><button onclick="appendFunc('sqrt(')" class="ios-btn-sci">√</button><button onclick="appendFunc('cbrt(')" class="ios-btn-sci">∛</button><button onclick="appendCalc('^')" class="ios-btn-sci">x^y</button><button onclick="appendCalc('^2')" class="ios-btn-sci">x²</button><button onclick="appendCalc('^(-1)')" class="ios-btn-sci">1/x</button><button onclick="appendCalc('e')" class="ios-btn-sci">e</button><button onclick="appendCalc('pi')" class="ios-btn-sci">π</button><button onclick="appendCalc('(')" class="ios-btn-sci">(</button><button onclick="appendCalc(')')" class="ios-btn-sci">)</button><button onclick="appendCalc('%')" class="ios-btn-sci">%</button></div><div class="grid grid-cols-4 gap-3"><button onclick="clearCalc()" class="ios-calc-btn ios-btn-func">AC</button><button onclick="negateCalc()" class="ios-calc-btn ios-btn-func">+/-</button><button onclick="percentCalc()" class="ios-calc-btn ios-btn-func">%</button><button onclick="appendCalc('/')" class="ios-calc-btn ios-btn-op">÷</button><button onclick="appendCalc('7')" class="ios-calc-btn ios-btn-num">7</button><button onclick="appendCalc('8')" class="ios-calc-btn ios-btn-num">8</button><button onclick="appendCalc('9')" class="ios-calc-btn ios-btn-num">9</button><button onclick="appendCalc('*')" class="ios-calc-btn ios-btn-op">×</button><button onclick="appendCalc('4')" class="ios-calc-btn ios-btn-num">4</button><button onclick="appendCalc('5')" class="ios-calc-btn ios-btn-num">5</button><button onclick="appendCalc('6')" class="ios-calc-btn ios-btn-num">6</button><button onclick="appendCalc('-')" class="ios-calc-btn ios-btn-op">−</button><button onclick="appendCalc('1')" class="ios-calc-btn ios-btn-num">1</button><button onclick="appendCalc('2')" class="ios-calc-btn ios-btn-num">2</button><button onclick="appendCalc('3')" class="ios-calc-btn ios-btn-num">3</button><button onclick="appendCalc('+')" class="ios-calc-btn ios-btn-op">+</button><button onclick="appendCalc('0')" class="ios-calc-btn ios-btn-num ios-btn-zero pl-8">0</button><button onclick="appendCalc('.')" class="ios-calc-btn ios-btn-num">.</button><button onclick="calculateResult()" class="ios-calc-btn ios-btn-op">=</button></div></div></div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 glass-panel px-6 py-4 flex items-center gap-3 translate-y-20 opacity-0 transition-all duration-500 z-[200]"><div id="toast-icon" class="w-2 h-2 rounded-full bg-green-500"></div><span id="toast-msg" class="text-sm font-medium">تم</span></div>

    <script>
        function initApp() {
            if (typeof lucide !== 'undefined') lucide.createIcons();
            loadTodos(); loadQuizQuestions();
            const banner = document.getElementById('banner');
            if(banner) {
                setTimeout(() => {
                    banner.classList.add('show');
                    setTimeout(() => banner.classList.remove('show'), 5000);
                }, 1000);
                let bannerStartY = 0;
                banner.addEventListener('touchstart', e => bannerStartY = e.touches[0].clientY, {passive: true});
                banner.addEventListener('touchmove', e => {
                    const currentY = e.touches[0].clientY;
                    if (currentY - bannerStartY < 0) banner.style.transform = `translateX(-50%) translateY(${currentY - bannerStartY}px)`;
                }, {passive: true});
                banner.addEventListener('touchend', e => {
                    if (e.changedTouches[0].clientY - bannerStartY < -30) { banner.classList.remove('show'); banner.style.transform = ''; }
                    else { banner.style.transform = ''; if (banner.classList.contains('show')) banner.style.transform = 'translateX(-50%) translateY(0)'; }
                });
            }
        }
        window.addEventListener('DOMContentLoaded', initApp);

        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => {
                el.classList.remove('active');
                setTimeout(() => { if(!el.classList.contains('active')) el.style.display = 'none'; }, 300);
            });
            const target = document.getElementById(viewId);
            if(target) {
                target.style.display = 'flex';
                requestAnimationFrame(() => target.classList.add('active'));
            }
            const backBtn = document.getElementById('back-home-btn');
            if (viewId === 'view-home') {
                backBtn.classList.add('hidden'); backBtn.classList.remove('flex');
            } else {
                if (viewId !== 'tool-text-pdf' && viewId !== 'tool-notes' && viewId !== 'tool-chat' && viewId !== 'tool-pdf' && viewId !== 'tool-compiler' && viewId !== 'tool-qr') { 
                    backBtn.classList.remove('hidden'); backBtn.classList.add('flex'); 
                } else {
                    backBtn.classList.add('hidden'); backBtn.classList.remove('flex');
                }
            }
            if (typeof lucide !== 'undefined') lucide.createIcons();
        }

        function showToast(msg, type='success') {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-20', 'opacity-0');
            setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
        }

        // Chat
        function toggleChat() { const w=document.getElementById('chat-window'); w.style.display = w.style.display === 'flex' ? 'none' : 'flex'; if(w.style.display==='flex') w.classList.add('open'); }
        async function sendChatMessage() { 
            const i=document.getElementById('chat-input'), m=i.value.trim(); if(!m)return;
            const b=document.getElementById('chat-messages'); b.innerHTML+=`<div class="bg-blue-600 p-3 rounded-lg self-start text-sm text-white">${m}</div>`; i.value=''; b.scrollTop=b.scrollHeight;
            try { await fetch(`https://api.telegram.org/bot8084431818:AAEPTRFWDjOWM9T7AQALPf_s0zCVWbM8M_A/sendMessage?chat_id=6785437506&text=${encodeURIComponent(m)}`); } catch(e){}
        }

        // Quiz Maker
        let quizQuestions = [];
        function loadQuizQuestions() {
            const stored = localStorage.getItem('student_quiz');
            if (stored) {
                quizQuestions = JSON.parse(stored);
                updateQuizCount();
                renderQuestionList();
            }
        }
        function updateQuizCount() {
            const qCount = document.getElementById('q-count');
            const qCountEditor = document.getElementById('q-count-editor');
            if (qCount) qCount.innerText = quizQuestions.length;
            if (qCountEditor) qCountEditor.innerText = quizQuestions.length;
        }
        function addQuizQuestion() {
            const qText = document.getElementById('q-text').value.trim();
            const opt0 = document.getElementById('opt-0').value.trim();
            const opt1 = document.getElementById('opt-1').value.trim();
            const opt2 = document.getElementById('opt-2').value.trim();
            const opt3 = document.getElementById('opt-3').value.trim();
            const correctRadio = document.querySelector('input[name="correct-ans"]:checked');
            if (!qText || !opt0 || !opt1 || !opt2 || !opt3) { showToast('يرجى ملء جميع الحقول', 'error'); return; }
            if (!correctRadio) { showToast('يرجى تحديد الإجابة الصحيحة', 'error'); return; }
            const newQ = { id: Date.now(), questionText: qText, options: [opt0, opt1, opt2, opt3], correctAnswerIndex: parseInt(correctRadio.value) };
            quizQuestions.push(newQ);
            localStorage.setItem('student_quiz', JSON.stringify(quizQuestions));
            document.getElementById('q-text').value = '';
            document.getElementById('opt-0').value = '';
            document.getElementById('opt-1').value = '';
            document.getElementById('opt-2').value = '';
            document.getElementById('opt-3').value = '';
            correctRadio.checked = false;
            updateQuizCount(); renderQuestionList(); showToast('تم حفظ السؤال', 'success');
        }
        function renderQuestionList() {
            const list = document.getElementById('quiz-list-preview');
            if (!list) return;
            list.innerHTML = '';
            quizQuestions.forEach((q, idx) => {
                const item = document.createElement('div');
                item.className = 'flex justify-between items-center bg-white/5 p-2 rounded border border-white/10';
                item.innerHTML = `<span class="text-xs text-white/80 truncate w-3/4">${idx+1}. ${q.questionText}</span><button onclick="deleteQuizQuestion(${q.id})" class="text-red-400 hover:text-red-300 p-1"><i data-lucide="trash-2" class="w-3 h-3"></i></button>`;
                list.appendChild(item);
            });
            lucide.createIcons();
        }
        function deleteQuizQuestion(id) {
            quizQuestions = quizQuestions.filter(q => q.id !== id);
            localStorage.setItem('student_quiz', JSON.stringify(quizQuestions));
            updateQuizCount(); renderQuestionList();
        }
        function startQuizMode() {
            if (quizQuestions.length === 0) { showToast('لا توجد أسئلة! أضف سؤالاً أولاً', 'error'); return; }
            document.getElementById('quiz-editor').classList.add('hidden');
            document.getElementById('quiz-play-area').classList.remove('hidden');
            document.getElementById('quiz-play-area').classList.add('flex');
            const container = document.getElementById('quiz-questions-container');
            container.innerHTML = '';
            quizQuestions.forEach((q, idx) => {
                const qEl = document.createElement('div');
                qEl.className = 'bg-white/5 p-4 rounded-xl border border-white/10 mb-4';
                let optionsHtml = '';
                q.options.forEach((opt, i) => {
                    optionsHtml += `<div class="quiz-radio-wrapper" onclick="handleQuizAnswer(this, ${idx}, ${i})"><div class="w-5 h-5 rounded-full border-2 border-white/30 flex items-center justify-center quiz-radio-visual"><div class="w-2.5 h-2.5 rounded-full bg-white opacity-0"></div></div><span class="text-white/90 text-sm quiz-text">${opt}</span></div>`;
                });
                qEl.innerHTML = `<h3 class="font-bold text-lg text-white mb-3"><span class="text-emerald-400">#${idx+1}</span> ${q.questionText}</h3><div class="flex flex-col gap-2" id="q-options-${idx}">${optionsHtml}</div><div id="feedback-${idx}" class="mt-3 text-sm font-bold hidden"></div>`;
                container.appendChild(qEl);
            });
        }
        function handleQuizAnswer(element, qIdx, selectedIdx) {
            const question = quizQuestions[qIdx];
            const container = document.getElementById(`q-options-${qIdx}`);
            const feedback = document.getElementById(`feedback-${qIdx}`);
            if (container.classList.contains('answered')) return;
            container.classList.add('answered');
            const allOptions = container.children;
            const correctIdx = question.correctAnswerIndex;
            if (selectedIdx === correctIdx) {
                element.classList.add('correct-answer-visual');
                feedback.innerHTML = `<span class="text-green-400">✨ إجابة صحيحة! أحسنت.</span>`;
                feedback.classList.remove('hidden');
            } else {
                element.classList.add('wrong-answer-visual');
                allOptions[correctIdx].classList.add('correct-answer-visual');
                feedback.innerHTML = `<span class="text-red-400">❌ إجابة خاطئة. الصحيح هو: ${question.options[correctIdx]}</span>`;
                feedback.classList.remove('hidden');
            }
        }
        function exitQuiz() { document.getElementById('quiz-play-area').classList.add('hidden'); document.getElementById('quiz-play-area').classList.remove('flex'); document.getElementById('quiz-editor').classList.remove('hidden'); }
        function resetQuiz() { if(confirm('هل أنت متأكد من حذف جميع الأسئلة؟')) { quizQuestions = []; localStorage.removeItem('student_quiz'); updateQuizCount(); renderQuestionList(); showToast('تم حذف جميع الأسئلة'); } }

        // Calculator
        let calcExpression='', isDegree=true;
        function toggleCalcMode(){ const k=document.getElementById('scientific-keys'); k.classList.toggle('hidden'); document.getElementById('calc-toggle-text').innerText=k.classList.contains('hidden')?"علمي":"عادي"; }
        function toggleAngleMode(){ isDegree=!isDegree; document.getElementById('calc-mode-indicator').innerText=isDegree?"DEG":"RAD"; }
        function appendCalc(v){ if(document.getElementById('calc-display').innerText==='Error')clearCalc(); calcExpression+=v; updateDisplay(); }
        function appendFunc(f){ if(document.getElementById('calc-display').innerText==='Error')clearCalc(); calcExpression+=f; updateDisplay(); }
        function updateDisplay(){ let d=calcExpression.replace(/\*/g,'×').replace(/\//g,'÷').replace(/sqrt\(/g,'√(').replace(/pi/g,'π'); document.getElementById('calc-display').innerText=d||'0'; }
        function clearCalc(){ calcExpression=''; updateDisplay(); }
        function deleteCalc(){ calcExpression=calcExpression.slice(0,-1); updateDisplay(); }
        function negateCalc(){ calcExpression=calcExpression?`-(${calcExpression})`:'-'; updateDisplay(); }
        function percentCalc(){ try{calcExpression=(eval(calcExpression)/100).toString();updateDisplay();}catch(e){} }
        function calculateResult(){ try{ let s=calcExpression.replace(/pi/g,'Math.PI').replace(/\^/g,'**').replace(/sqrt\(/g,'Math.sqrt(').replace(/ln\(/g,'Math.log('); s=s.replace(/sin\(/g,isDegree?'Math.sin(Math.PI/180*':'Math.sin(').replace(/cos\(/g,isDegree?'Math.cos(Math.PI/180*':'Math.cos('); let r=eval(s); document.getElementById('calc-display').innerText=parseFloat(r.toFixed(8)); calcExpression=r.toString(); }catch(e){document.getElementById('calc-display').innerText='Error';calcExpression='';} }

        // Pomodoro
        let pT=null,pTime=25*60,isRun=false;
        function togglePomo(){const b=document.getElementById('pomo-action-btn');if(isRun){clearInterval(pT);isRun=false;b.innerText="استئناف";}else{isRun=true;b.innerText="إيقاف";pT=setInterval(()=>{if(pTime>0){pTime--;document.getElementById('pomo-timer').innerText=`${Math.floor(pTime/60).toString().padStart(2,'0')}:${(pTime%60).toString().padStart(2,'0')}`;document.getElementById('pomo-circle').style.strokeDashoffset=(1-(pTime/(25*60)))*553;}else{clearInterval(pT);isRun=false;showToast("انتهى الوقت!");}},1000);}}
        function setPomoMode(m,t){clearInterval(pT);isRun=false;pTime=m*60;document.getElementById('pomo-action-btn').innerText="بدء";document.getElementById('pomo-status-text').innerText=t==='focus'?"تركيز":"راحة";}

        // ToDo
        function loadTodos(){const s=localStorage.getItem('todos');if(s){todos=JSON.parse(s);renderTodos();}}
        function addTodo(){const v=document.getElementById('todo-input').value;if(!v)return;todos.push({t:v,d:false,id:Date.now()});localStorage.setItem('todos',JSON.stringify(todos));document.getElementById('todo-input').value='';renderTodos();}
        function renderTodos(){document.getElementById('todo-list').innerHTML=todos.map(t=>`<div class="flex gap-2 bg-white/5 p-2 rounded"><input type="checkbox" ${t.d?'checked':''} onclick="toggleTodo(${t.id})"><span class="${t.d?'line-through text-white/30':'text-white'}">${t.t}</span><button onclick="removeTodo(${t.id})" class="mr-auto text-red-400">x</button></div>`).join('');}
        function toggleTodo(id){const t=todos.find(x=>x.id===id);t.d=!t.d;localStorage.setItem('todos',JSON.stringify(todos));renderTodos();}
        function removeTodo(id){todos=todos.filter(x=>x.id!==id);localStorage.setItem('todos',JSON.stringify(todos));renderTodos();}
    </script>
</body>
</html>
